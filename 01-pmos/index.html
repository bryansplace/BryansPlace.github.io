
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="..">
      
      
        <link rel="next" href="../02-SWAG/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.21">
    
    
      
        <title>Reuse an Old Smart Phone - My Docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.66ac8b77.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#1-introduction" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="My Docs" class="md-header__button md-logo" aria-label="My Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            My Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Reuse an Old Smart Phone
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="My Docs" class="md-nav__button md-logo" aria-label="My Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    My Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Welcome
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Reuse an Old Smart Phone
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Reuse an Old Smart Phone
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-introduction" class="md-nav__link">
    <span class="md-ellipsis">
      1) Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-pmbootstrap" class="md-nav__link">
    <span class="md-ellipsis">
      2) PMbootstrap
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2) PMbootstrap">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-install-pmbootstrap" class="md-nav__link">
    <span class="md-ellipsis">
      2.1) Install PMbootstrap
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-enable-usb-connection" class="md-nav__link">
    <span class="md-ellipsis">
      2.2) Enable USB connection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-usb-cable" class="md-nav__link">
    <span class="md-ellipsis">
      2.3) USB cable
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-postmarketos" class="md-nav__link">
    <span class="md-ellipsis">
      3) PostmarketOS
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3) PostmarketOS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-enable-fastboot-mode" class="md-nav__link">
    <span class="md-ellipsis">
      3.1) Enable Fastboot mode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-oem-unlock" class="md-nav__link">
    <span class="md-ellipsis">
      3.2) OEM unlock
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-initialization" class="md-nav__link">
    <span class="md-ellipsis">
      3.3) Initialization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34-build-images" class="md-nav__link">
    <span class="md-ellipsis">
      3.4) Build images
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#35-flash-to-phone" class="md-nav__link">
    <span class="md-ellipsis">
      3.5) Flash to phone
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#36-login-and-enable-ssh" class="md-nav__link">
    <span class="md-ellipsis">
      3.6) Login and enable SSH
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-setup-wifi" class="md-nav__link">
    <span class="md-ellipsis">
      4) Setup WIFI
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4) Setup WIFI">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-install-bluetooth" class="md-nav__link">
    <span class="md-ellipsis">
      4.1) Install Bluetooth
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-test-wifi" class="md-nav__link">
    <span class="md-ellipsis">
      4.2) Test Wifi
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-check-reboot" class="md-nav__link">
    <span class="md-ellipsis">
      4.3) Check reboot
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-install-docker" class="md-nav__link">
    <span class="md-ellipsis">
      5) Install Docker
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5) Install Docker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-install-docker" class="md-nav__link">
    <span class="md-ellipsis">
      5.1) Install Docker
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-test-docker" class="md-nav__link">
    <span class="md-ellipsis">
      5.2) Test Docker
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-clean-up" class="md-nav__link">
    <span class="md-ellipsis">
      5.3) Clean up
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-home-assistant" class="md-nav__link">
    <span class="md-ellipsis">
      6 Home assistant
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6 Home assistant">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-create-storage-volumes" class="md-nav__link">
    <span class="md-ellipsis">
      6.1) Create storage volumes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#63-docker-compose" class="md-nav__link">
    <span class="md-ellipsis">
      6.3) docker-compose
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#64-docker-compose-up" class="md-nav__link">
    <span class="md-ellipsis">
      6.4) Docker-compose up
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-wrap-up" class="md-nav__link">
    <span class="md-ellipsis">
      7) Wrap up
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../02-SWAG/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Remote access to HASS
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-introduction" class="md-nav__link">
    <span class="md-ellipsis">
      1) Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-pmbootstrap" class="md-nav__link">
    <span class="md-ellipsis">
      2) PMbootstrap
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2) PMbootstrap">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-install-pmbootstrap" class="md-nav__link">
    <span class="md-ellipsis">
      2.1) Install PMbootstrap
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-enable-usb-connection" class="md-nav__link">
    <span class="md-ellipsis">
      2.2) Enable USB connection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-usb-cable" class="md-nav__link">
    <span class="md-ellipsis">
      2.3) USB cable
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-postmarketos" class="md-nav__link">
    <span class="md-ellipsis">
      3) PostmarketOS
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3) PostmarketOS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-enable-fastboot-mode" class="md-nav__link">
    <span class="md-ellipsis">
      3.1) Enable Fastboot mode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-oem-unlock" class="md-nav__link">
    <span class="md-ellipsis">
      3.2) OEM unlock
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-initialization" class="md-nav__link">
    <span class="md-ellipsis">
      3.3) Initialization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34-build-images" class="md-nav__link">
    <span class="md-ellipsis">
      3.4) Build images
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#35-flash-to-phone" class="md-nav__link">
    <span class="md-ellipsis">
      3.5) Flash to phone
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#36-login-and-enable-ssh" class="md-nav__link">
    <span class="md-ellipsis">
      3.6) Login and enable SSH
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-setup-wifi" class="md-nav__link">
    <span class="md-ellipsis">
      4) Setup WIFI
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4) Setup WIFI">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41-install-bluetooth" class="md-nav__link">
    <span class="md-ellipsis">
      4.1) Install Bluetooth
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42-test-wifi" class="md-nav__link">
    <span class="md-ellipsis">
      4.2) Test Wifi
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43-check-reboot" class="md-nav__link">
    <span class="md-ellipsis">
      4.3) Check reboot
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-install-docker" class="md-nav__link">
    <span class="md-ellipsis">
      5) Install Docker
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5) Install Docker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-install-docker" class="md-nav__link">
    <span class="md-ellipsis">
      5.1) Install Docker
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-test-docker" class="md-nav__link">
    <span class="md-ellipsis">
      5.2) Test Docker
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53-clean-up" class="md-nav__link">
    <span class="md-ellipsis">
      5.3) Clean up
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-home-assistant" class="md-nav__link">
    <span class="md-ellipsis">
      6 Home assistant
    </span>
  </a>
  
    <nav class="md-nav" aria-label="6 Home assistant">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-create-storage-volumes" class="md-nav__link">
    <span class="md-ellipsis">
      6.1) Create storage volumes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#63-docker-compose" class="md-nav__link">
    <span class="md-ellipsis">
      6.3) docker-compose
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#64-docker-compose-up" class="md-nav__link">
    <span class="md-ellipsis">
      6.4) Docker-compose up
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-wrap-up" class="md-nav__link">
    <span class="md-ellipsis">
      7) Wrap up
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Reuse an Old Smart Phone</h1>

<h2 id="1-introduction">1) Introduction</h2>
<p>Docker can be installed onto an old smartphone using PostmarketOS .</p>
<p>Here is step by step guide to install PostmarketOS, then  Docker, then Home Assistant onto an old Xiaomi A1 (Tissot) phone.
I provide links to  documentation ( which usually covers all user cases and can be bewildering).</p>
<p>If you don't have a Xiaomi A1,  PostmarketOS may have have a version for your device. But, beware, the large majority of devices are only partly converted by hobbyists. You might be lucky, but here only Tissot  is addressed......</p>
<p>The full documentation for PostmarketOS can be found <a href="https://wiki.postmarketos.org/wiki/Main_Page">here</a></p>
<p>I'm  pretty certain this guide works (today) for a Tissot if followed step by step; but I can't provide further help.</p>
<p>Some steps can take a long time; wait, don't panic too fast. If something has gone wrong (probably due to my inadequate explaination or low battery), just simultaneously hold down the power and volume down buttons untill the system reboots. If it doesn't, you're probably out of power.</p>
<p>Let's get started.</p>
<h2 id="2-pmbootstrap">2) PMbootstrap</h2>
<p>PostmarketOS has an installation program called <a href="https://wiki.postmarketos.org/wiki/Pmbootstrap">PMbootstrap</a>. This takes care of rooting and all the stuff required to install the system on your phone.</p>
<p>However, it only runs on  a linux system. If you already have one at your disposal, no problem, but I wasted a lot of time trying windows WSL (Windows Subsystem for Linux) without success as it needs to correctly access usd drivers. 
I eventually installed Ubuntu on an old laptop. </p>
<h3 id="21-install-pmbootstrap">2.1) Install PMbootstrap</h3>
<p>The official installation instructions can be found <a href="https://wiki.postmarketos.org/wiki/Installing_pmbootstrap">here</a></p>
<p>I installed it a couple of years ago using pip. I'm not sure this is still valid...I leave it here for my reference....</p>
<p>Open a terminal window ( CTRL+ALT+T) and run the following commands:</p>
<pre><code>sudo apt update
sudo apt upgrade
sudo apt install python3-pip openssl git nano android-tools-adb android-tools-fastboot -y
sudo pip3 install --user pmbootstrap
sudo source ~/.profile
</code></pre>
<p>To test that pmbootstrap is installed correctly, run:</p>
<pre><code>pmbootstrap --version
</code></pre>
<p>You should see the installed version.</p>
<h3 id="22-enable-usb-connection">2.2) Enable USB connection</h3>
<p>In order to use a USB cable to communicate between the Android phone and the computer, something called 'USB debugging' needs to be enabled on the phone. </p>
<p>Go to the phone Settings -&gt; About -&gt; Tap build number repeatedly until developer menu is enabled. Then tap on “ developer options ” and tick USB debugging.</p>
<p>A Google search eg ' Tissot enable USB debugging' will give lots of instructions and videos if needed.</p>
<h3 id="23-usb-cable">2.3) USB cable</h3>
<p>I used to think all USB cables were more or less the same. But experience taught me that they are finiky and a source of problems.  A cable might work sometimes, but not other times. If things in the subsequent steps don't go right; try another cable and/or USB port.</p>
<h2 id="3-postmarketos">3) PostmarketOS</h2>
<p>With the PMbootrap program installed on your linux system, it is time to configure and install the Postmarket operating system onto the phone.</p>
<p>The official instructions for a Tissot are found <a href="https://wiki.postmarketos.org/wiki/Xiaomi_Mi_A1_(xiaomi-tissot)">here</a></p>
<p>If you have another device, search <a href="https://wiki.postmarketos.org/wiki/Devices">here</a> to see if PostmarketOS is available. There are three  categories:
 -  main ( a few well supported devices)
 -  community ( quite a few maintained devices)
 -  testing ( devices people have worked on)</p>
<p>The Tissot is in the community category. My earlier Nexus 5 was in the testing category, but I got things working.</p>
<p>The official instructions contain lots and lots  of info which can confuse a beginner ( at least me). The following are the steps I used.</p>
<p>Starting from a standard, charged device...</p>
<h4 id="31-enable-fastboot-mode">3.1) Enable Fastboot mode</h4>
<p>With phone powered off and USB cable unplugged, hold down Volume Down and Power buttons simultaneously for a few seconds, until something called Fastboot Mode screen  appears.   </p>
<h4 id="32-oem-unlock">3.2) OEM unlock</h4>
<p>Plug in the USB cable between PC and phone, then on the PC run:</p>
<pre><code>$ sudo fastboot oem unlock
</code></pre>
<p>When prompted on the the phone device, use Volume Up/Down buttons to highlight 'Yes' choice, then press the Power button to select it.   </p>
<h4 id="33-initialization">3.3) Initialization</h4>
<p>On your PC, run</p>
<pre><code class="language-yaml">$pmbootstrap init
</code></pre>
<p>This will give a series of options. Accept all defaults, except ( for the Tissot device) choose:</p>
<p>Channel:                    Edge;              <br />
Vendor:                      Xiaomi ;                  <br />
Device codename:  Tissot <br />
User Interface:.        none
Additional packages : nano,networkmanager,networkmanager-wifi,networkmanager-cli,networkmanager-tui,wpa_supplicant</p>
<p>You'll be asked for a username . This will later be needed for login to the phone device ( both initial Screen and later SSH)</p>
<p>Notes: The channel has two options. A stable release or edge. I first chose stable release, but layer found I couldn't access a NAS file share because 'cifs' kernel requirements were only in edge. This might change in future. Also, it is strange addiditonal network packages are needed.</p>
<h4 id="34-build-images">3.4) Build images</h4>
<p>On your PC, run</p>
<pre><code>$ pmbootstrap install
</code></pre>
<p>This builds the boot and system images that are to be installed. 
You'll be asked to set a password for logging onto the phone device later on. ( Ignore any keymap warning)</p>
<h4 id="35-flash-to-phone">3.5) Flash  to phone</h4>
<p>Ensure device is still in fastboot mode ( ref 1 above), and plugged  in via USB. Then, on the PC, run:</p>
<pre><code class="language-yaml">pmbootstrap flasher flash_lk2nd --boot_a
pmbootstrap flasher flash_lk2nd --boot_b
fastboot erase system_a
fastboot erase system_b
pmbootstrap flasher flash_rootfs
fastboot reboot
</code></pre>
<p>Notes: The Tissot  uses an A/B update system..</p>
<p>Wait a while (a couple of minutes) as the phone reboots with PostmarketOS.</p>
<h4 id="36-login-and-enable-ssh">3.6) Login and enable SSH</h4>
<p>With the USB cable still connected, from your PC terminal ; with your user name run</p>
<pre><code class="language-yaml">$ssh user@172.16.42.1  
</code></pre>
<p>You will be asked for your password from step 3.4.</p>
<p>Hopefully, you now have control of the phone from your computer.</p>
<h2 id="4-setup-wifi">4) Setup WIFI</h2>
<p>In the 'edge' release used, network stuff needs to be started automatically and (strangely) 
In the SSH session,  set up the WIFI ( and add network stuff to start)in the SSH run</p>
<pre><code>sudo rc-update add networkmanager
sudo rc-update add wpa_supplicant
sudo ntpd -d -q -n -p pool.ntp.org
sudo nmtui
</code></pre>
<p>This gives a 'somewhat' intuitive screen where you  can activate the WIFI. 
(Use a google search for 'nmtui' for instructions if needed).</p>
<p>You'll probably want to set up a static IP address for the phone on your router or preferably using nmtui.
 A static address can be set using nmtui  explained  <a href="https://www.tecmint.com/nmtui-configure-network-connection/">here</a></p>
<h4 id="41-install-bluetooth">4.1) Install Bluetooth</h4>
<p>I use Homeassistant to read  bluetooth BLE temperature sensors using the 'HACS Passive BLE Monitor' integration using the phone's bluetooth capability.</p>
<p>Setting up the Bluetooth can be done later or skipped.</p>
<p>To set up bluetooth ; </p>
<pre><code class="language-yaml">sudo apk add bluez
sudo apk add dbus-broker
sudo rc-update add bluetooth boot
sudo service bluetooth start

bluetoothctl power on
bluetoothctl  scan le
bluetooth
   scan on
</code></pre>
<p>This will add bluetooth software, set it to start  after a reboot, and start a scan for bluetooth low energy ( le) devices. Exit to stop.</p>
<h4 id="42-test-wifi">4.2) Test Wifi</h4>
<p>Stop the SSH session ( type exit) and disconnect the USB cable.
From the PC, login using the wifi connection</p>
<pre><code class="language-yaml">$ssh user@192.168.X.XXX:21        
</code></pre>
<p>where 192.168.X.XXX is the IP address of your phone device.</p>
<h4 id="43-check-reboot">4.3) Check reboot</h4>
<p>Now is a good time to check everything properly restarts after a system start, so run</p>
<pre><code>sudo reboot
</code></pre>
<p>After the phone display comes back, login again and retest ( USB cable unplugged)</p>
<pre><code>$ssh user@192.168.X.XXX:21
</code></pre>
<p>Hopefully, no problems.....</p>
<p>You now have PostmarketOS on the phone
.</p>
<h2 id="5-install-docker">5) Install Docker</h2>
<p>Up to this point, this has been standard PostmarketOS installation.</p>
<p>PostmarketOS supports Docker, so this makes installing Home Assistant (and other Docker containers) straight forward.</p>
<p>In this short section, we install docker and docker-compose.</p>
<h3 id="51-install-docker">5.1) Install Docker</h3>
<p>From now on, I assume you are connected by (wifi) SSH.</p>
<p>Following the instructions for installing  Docker on <a href="https://wiki.alpinelinux.org/wiki/Docker">Alpine Linux</a></p>
<pre><code class="language-yaml">sudo apk upgrade
sudo apk update
sudo apk add docker
sudo addgroup bryan docker         
sudo rc-update add docker boot
sudo service docker start
+sudo apk add docker-cli-compose
-sudo apk add docker-compose
sudo reboot
</code></pre>
<p>Obviously change 'bryan' for your user name...</p>
<h3 id="52-test-docker">5.2) Test  Docker</h3>
<p>To check docker, run:</p>
<pre><code>docker run hello-world
</code></pre>
<p>This should pull and run a very simple test that prints a message "Hello from Docker" and then exit.</p>
<h3 id="53-clean-up">5.3) Clean up</h3>
<p>Assuming all is ok, run:</p>
<pre><code>docker system prune -a
</code></pre>
<p>This will clean up and remove all docker stuff that is not being used.</p>
<h2 id="6-home-assistant">6 Home assistant</h2>
<p>We'll now use docker-compose to install Home Assistant along with an MQTT broker.</p>
<p>The Home Assistant site gives instructions how to set up using docker-compose <a href="https://www.home-assistant.io/installation/linux/#docker-compose">here</a>.</p>
<p>In theory, you can follow those instructions. However, I think it is better to create storage volumes first because, if you let  Docker make them, you will not have  permissions to modify them outside of Home assistant.</p>
<h3 id="61-create-storage-volumes">6.1) Create storage volumes</h3>
<p>So,  to create the storage volumes on the PostmarkerOS phone I suggest:</p>
<pre><code>mkdir ~/volumes
mkdir ~/volumes/hass
mkdir ~/volumes/mosquitto
mkdir ~/volumes/mosquitto/config
</code></pre>
<p>The mosquitto MQTT broker needs a config file, create it with :</p>
<pre><code>nano ~/volumes/mosquitto/config/mosquitto.conf
</code></pre>
<p>Set the configuration as:</p>
<pre><code>allow_anonymous true
listener 1883 0.0.0.0
#logging
log_type none  
</code></pre>
<p>( Ctrl- O &amp; Ctrl-X to save and exit)</p>
<h3 id="63-docker-compose">6.3) docker-compose</h3>
<p>The docker-compose.yml file groups all the docker commands needed to load the  systems we want; currently HomeAssistant and MQTT. </p>
<p>Where you put this file isn't critical; to keep things simple I suggest you create it in the home directory (~).</p>
<p>Note: To create a text file, the Linux command line editors (eg nano) are ...what can I say..... geeky . You can use Nano that was  installed during the earlier setup or install another editor. I personally use 'CX file explorer' on my normal android phone and connect via SFTP.</p>
<p>Whatever,  create the file 'docker-compose.yml' 
and insert the following for homeassistant and mqtt services</p>
<pre><code class="language-yaml">version: '3'
services:
  homeassistant:
    container_name: homeassistant
    image: &quot;ghcr.io/home-assistant/home-assistant:2022.7.1&quot;
    volumes:
      - /home/bryan/volumes/hass:/config
      - /etc/localtime:/etc/localtime:ro
      - /run/dbus:/run/dbus:ro
      - /sys:/sys
    network_mode: host
    restart: unless-stopped
    depends_on:
      - mqtt

  mqtt:
    container_name: mqtt    
    image: &quot;eclipse-mosquitto:1.6.13&quot;
    volumes:
      - /home/bryan/volumes/mosquitto/config:/mosquitto/config
      - /home/bryan/volumes/mosquitto/log:/mosquitto/log
      - /home/bryan/volumes/mosquitto/data:/mosquitto/data
      - /etc/localtime:/etc/localtime:ro
    network_mode: host
    restart: unless-stopped
</code></pre>
<p>Obviously, change 'bryan' to your user name.</p>
<p>The versions (eg :1.6.13) are optional, but I like to 'freeze' the versions to avoid surprises</p>
<p>This contains the instructions to pull ( download) the standard docker 'image' to build your working 'container'. The volumes tell it where to store data and the network mode 'host' tells it not to isolate  containers in a separate network as Docker would normally do.</p>
<h3 id="64-docker-compose-up">6.4) Docker-compose up</h3>
<p>When run for the first time, the following instruction will cause docker to pull (download) and extract the files. This is time consuming and needs the battery charged.</p>
<pre><code>sudo docker-compose pull
</code></pre>
<p>When everything finishes downloading,  run</p>
<pre><code>sudo docker-compose  up -d 
</code></pre>
<p>This will start Home Assistant; the -d flag is detached mode which gives you back control of the console.</p>
<p>Wait a few minutes as things take a little time to set up the first time.</p>
<p>To access Home Assistant, from any machine on your local network, use an internet browser to connect to 192.168.X.XXX/8123.</p>
<p>You should have access to the normal home assistant log-in screen.</p>
<h2 id="7-wrap-up">7) Wrap up</h2>
<p>That's it. I hope you found this guide informative.</p>
<p>With docker, it's easy to set up other packages. The Tissot has 32GB of memory and it surprised me what can be done. My Home Assistant is minimal (mostly temperature sensors) and I have also running
   Wireguard VPN server
   Wordpress &amp; maraidb web server
   Crowdsec security
   Swag/Letsencrypt remote access
   Jupyter Notebook server</p>
<p>Hope you have fun.......  </p>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.a7c05c9e.min.js"></script>
      
        <script src="../search/main.js"></script>
      
    
  </body>
</html>